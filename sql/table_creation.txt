DROP TABLE Transaction;
DROP TABLE Recycler;
DROP TABLE Shipment;
DROP TABLE SportingGood;
DROP TABLE MusicalInstrument;
DROP TABLE Clothing;
DROP TABLE Technology;
DROP TABLE Textbook;
DROP TABLE Inventory;
DROP TABLE UsedIn;
DROP TABLE Isbn;
DROP TABLE Class;
DROP TABLE StfxUser;

CREATE TABLE StfxUser (
        UserID      NUMBER(9)             NOT NULL,
        First       VARCHAR2(20)          NOT NULL,
        Last        VARCHAR2(20)          NOT NULL,
        Address     VARCHAR2(40),
        PRIMARY KEY (UserID),
        CONSTRAINT Valid_UID CHECK (UserID > 201000000 AND UserID < 299999999)
);
GRANT SELECT ON StfxUser TO PUBLIC;


CREATE TABLE Class (
        Crn         NUMBER(5)             NOT NULL,
        DeptCode    VARCHAR2(4)           NOT NULL,
        CourseNo    NUMBER(3)             NOT NULL,
        CourseName  VARCHAR2(30),
        PRIMARY KEY (Crn),
        CONSTRAINT Valid_CourseNo CHECK (CourseNo > 99 AND CourseNo < 700)
);
GRANT SELECT ON Class TO PUBLIC;


CREATE TABLE Isbn (
        Isbn        NUMBER(4)             NOT NULL,
        Title       VARCHAR2(20),
        Author      VARCHAR2(40),
        Edition     NUMBER(2),
        PRIMARY KEY (Isbn)
);
GRANT SELECT ON Isbn TO PUBLIC;


CREATE TABLE UsedIn (
        Crn         NUMBER(5),
        Isbn        NUMBER(5),
        Year        NUMBER(4),
        PRIMARY KEY (Crn, Isbn, Year),
        CONSTRAINT FK_UsedIn_Crn    FOREIGN KEY (Crn)  REFERENCES Class(Crn),
        CONSTRAINT FK_UsedIn_Isbn   FOREIGN KEY (Isbn) REFERENCES Isbn(Isbn)
);
GRANT SELECT ON UsedIn TO PUBLIC;


CREATE TABLE Inventory (
        ItemID      NUMBER(7),
        UserID      NUMBER(9)            NOT NULL,
        ListPrice   NUMBER(8, 2),
        PostDate    DATE,
        Category    VARCHAR(10),
        PostType    CHAR(1),
        Description VARCHAR(100),
        KeyWords    VARCHAR(40),
        PRIMARY KEY (ItemID),
        CONSTRAINT FK_Inv_UserID    FOREIGN KEY (UserID)  REFERENCES StfxUser(UserID)
);
GRANT SELECT ON Inventory TO PUBLIC;


CREATE TABLE Textbook (
        ItemID       NUMBER(7),
        Isbn         NUMBER(5),
        PRIMARY KEY  (ItemID),
        CONSTRAINT FB_TB_ItemID     FOREIGN KEY (ItemID) REFERENCES Inventory(ItemID),
        CONSTRAINT FK_TB_Isbn       FOREIGN KEY (Isbn)   REFERENCES Isbn(Isbn)
);
GRANT SELECT ON Textbook TO PUBLIC;


CREATE TABLE Technology (
        ItemID        NUMBER(7),
        Brand         VARCHAR(20),
        DeviceType    VARCHAR(20),    
        SerialNo      NUMBER(20),
        PRIMARY KEY   (ItemID),
        CONSTRAINT FK_Tech_ItemID   FOREIGN KEY (ItemID) REFERENCES Inventory(ItemID)
);
GRANT SELECT ON Technology TO PUBLIC;


CREATE TABLE Clothing (
        ItemID        NUMBER(7),
        Brand         VARCHAR(20),
        CSize         VARCHAR(10),
        Article       VARCHAR(10),
        PRIMARY KEY   (ItemID),
        CONSTRAINT FK_Cloth_ItemID  FOREIGN KEY (ItemID) REFERENCES Inventory(ItemID)
);
GRANT SELECT ON Clothing TO PUBLIC;


CREATE TABLE MusicalInstrument (
        ItemID        NUMBER(7),
        InstrType     VARCHAR(20),
        PRIMARY KEY   (ItemID),
        CONSTRAINT FK_MI_ItemID     FOREIGN KEY (ItemID) REFERENCES Inventory(ItemID)
);
GRANT SELECT ON MusicalInstrument TO PUBLIC;


CREATE TABLE SportingGood (
        ItemID        NUMBER(7),
        Sport         VARCHAR(20),
        PRIMARY KEY   (ItemID),
        CONSTRAINT FK_SG_ItemID     FOREIGN KEY (ItemID) REFERENCES Inventory(ItemID)
);
GRANT SELECT ON SportingGood TO PUBLIC;


CREATE TABLE Shipment (
        ShipID        NUMBER(7),
        ItemID        NUMBER(7)      NOT NULL,
        UserAddress   VARCHAR2(40)   NOT NULL,
        RcyclAddress  VARCHAR2(40)   NOT NULL,
        DateShipped   DATE,
        DateReceieved DATE,
        PRIMARY KEY   (ShipID),
        CONSTRAINT FB_Ship_ItemID    FOREIGN KEY (ItemID) REFERENCES Inventory(ItemID)
);
GRANT SELECT ON Shipment TO PUBLIC;


CREATE TABLE Recycler (
        RcyclID       NUMBER(7),
        Name          VARCHAR(20),
        PhoneNo       NUMBER(10),
        Email         VARCHAR(30),
        Address       VARCHAR(40),
        ItemCategory  VARCHAR(40),
        PRIMARY KEY   (RcyclID)
);
GRANT SELECT ON Recycler TO PUBLIC;


CREATE TABLE Transaction (
        TransID       NUMBER(7),
        TransPrice    NUMBER(8, 2),
        GiverID       NUMBER(9),
        ReceiverID    NUMBER(9),
        TransDate     DATE,
        Address       VARCHAR(40),
        PRIMARY KEY   (TransID),
        CONSTRAINT FK_Trans_Giver    FOREIGN KEY (GiverID)    REFERENCES StfxUser(UserID),
        CONSTRAINT FK_Trans_Receiver FOREIGN KEY (ReceiverID) REFERENCES StfxUser(UserID)
);
GRANT SELECT ON Transaction TO PUBLIC;
